# 排序功能修复验证

## 🎯 核心问题已识别并修复

### 问题根因
前端`useInfiniteScroll`钩子的`loadData`函数依赖项缺少`sortBy`，导致：
- 当用户切换排序选项时，`loadData`函数没有重新创建
- 函数仍然使用旧的`sortBy`值发送API请求
- 结果看起来排序没有变化

### 修复内容
在`src/hooks/useInfiniteScroll.ts`第107行，添加了`sortBy`依赖项：

```typescript
// 修复前
}, [endpoint, limit, search, enabled])

// 修复后  
}, [endpoint, limit, search, sortBy, enabled])
```

### 验证修复效果

现在请测试以下步骤：

1. **访问页面**: http://localhost:3000/papers
2. **查看初始排序**: 应该显示"最新评论"排序（默认）
3. **切换到"评分最高"**: 
   - 点击排序下拉菜单
   - 选择"评分最高"
   - 页面应该重新加载，显示按评分排序的论文
4. **切换到"评论最多"**:
   - 选择"评论最多" 
   - 页面应该重新加载，显示按评论数量排序的论文

### 预期结果
- 每次切换排序选项时，应该看到论文的顺序发生变化
- 开发者工具的网络选项卡中应该能看到新的API请求
- 服务器日志中应该显示不同的`sortBy`参数

### 技术说明
这是一个典型的React hooks依赖项问题：
- `useCallback`和`useEffect`的依赖项必须包含所有使用的状态和props
- 缺少依赖项会导致闭包捕获旧值，产生stale closure问题
- 添加`sortBy`依赖项确保状态变化时函数重新创建

## 状态总结

✅ **评论数量显示** - 已修复  
✅ **排序API逻辑** - 已确认正常  
✅ **前端排序触发** - 已修复依赖项问题  
🔄 **等待用户确认** - 请测试排序功能是否现在正常工作

如果仍有问题，请告诉我具体的表现！
