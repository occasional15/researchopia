# 学术评价网站功能测试指南

本指南将引导您完成所有核心功能的测试，包括管理员账号创建和各项功能验证。

## 🚀 快速开始

### 1. 环境准备

确保以下服务正在运行：
- **开发服务器**: `npm run dev` (http://localhost:3000)
- **Supabase项目**: 已配置并运行
- **数据库**: 已执行 schema.sql

### 2. 管理员账号设置

#### 步骤 1: 注册管理员账号
1. 访问 http://localhost:3000
2. 点击右上角"注册"按钮
3. 使用以下信息注册：
   - **邮箱**: `admin@test.edu.cn`
   - **用户名**: `admin`
   - **密码**: `Admin123!@#`
4. 完成邮箱验证（如果需要）

#### 步骤 2: 提升为管理员
1. 登录 Supabase 控制台
2. 进入 SQL Editor
3. 执行以下命令：
```sql
UPDATE public.users 
SET role = 'admin' 
WHERE email = 'admin@test.edu.cn';
```

#### 步骤 3: 添加测试数据
1. 在 SQL Editor 中运行 `database/test-data.sql`
2. 执行函数添加评分和评论：
```sql
SELECT add_test_ratings_and_comments();
```

## 📋 功能测试清单

### ✅ 1. DOI搜索和条目添加

#### 测试用例 1.1: DOI自动搜索
1. **访问添加论文页面**: http://localhost:3000/papers/new
2. **测试DOI**: `10.1038/nature17946`
3. **预期结果**: 
   - 自动获取论文信息
   - 显示论文预览
   - 2秒后自动跳转到论文详情页

#### 测试用例 1.2: 快速测试DOI
在DOI搜索框中点击以下示例DOI：
- `10.1038/nature17946`
- `10.1126/science.aaf2654`
- `10.1038/s41586-019-1666-5`

#### 测试用例 1.3: 无效DOI处理
1. **输入无效DOI**: `invalid-doi`
2. **预期结果**: 显示错误提示

#### 测试用例 1.4: 重复DOI处理
1. **重复搜索相同DOI**: `10.1038/nature17946`
2. **预期结果**: 直接跳转到已存在的论文页面

### ✅ 2. 用户认证系统

#### 测试用例 2.1: 教育邮箱验证
测试以下邮箱格式：
- ✅ `user@stanford.edu` (美国大学)
- ✅ `student@tsinghua.edu.cn` (中国大学)
- ✅ `researcher@ox.ac.uk` (英国大学)
- ❌ `user@gmail.com` (非教育邮箱)

#### 测试用例 2.2: 访客模式
1. **未登录状态**访问论文详情页
2. **预期结果**: 可以查看内容，但评分/评论按钮显示"登录以..."

### ✅ 3. 评分系统

#### 测试用例 3.1: 多维度评分
1. **登录管理员账号**
2. **访问论文详情页**: 选择任一论文
3. **进行评分**:
   - 创新性: 5分
   - 方法论: 4分
   - 实用性: 5分
   - 总体评价: 5分
4. **预期结果**: 评分成功提交，页面显示更新

#### 测试用例 3.2: 评分更新
1. **修改之前的评分**
2. **预期结果**: 评分被更新，不会创建重复记录

#### 测试用例 3.3: 访客评分限制
1. **退出登录**
2. **尝试评分**
3. **预期结果**: 弹出登录框

### ✅ 4. 评论系统

#### 测试用例 4.1: 发表评论
1. **登录状态下**访问论文详情页
2. **发表评论**: "这是一篇非常优秀的论文，方法创新，实验充分。"
3. **预期结果**: 评论成功发表并显示

#### 测试用例 4.2: 评论点赞/踩
1. **对评论进行点赞**
2. **预期结果**: 点赞数增加，按钮状态改变
3. **再次点击点赞**
4. **预期结果**: 取消点赞
5. **点击踩**
6. **预期结果**: 踩数增加，点赞变为踩

#### 测试用例 4.3: 访客评论限制
1. **退出登录**
2. **尝试发表评论**
3. **预期结果**: 显示"登录以发表评论"按钮

#### 测试用例 4.4: 评论删除
1. **删除自己的评论**
2. **预期结果**: 弹出确认框，确认后评论被删除

### ✅ 5. 管理员功能

#### 测试用例 5.1: 管理员控制台访问
1. **使用管理员账号登录**
2. **点击用户菜单**
3. **预期结果**: 显示"管理员控制台"选项
4. **访问**: http://localhost:3000/admin
5. **预期结果**: 显示管理员仪表板

#### 测试用例 5.2: 系统统计查看
1. **在管理员控制台**查看统计数据
2. **预期结果**: 显示用户数、论文数、评分数、评论数等

#### 测试用例 5.3: 管理员删除权限
1. **以管理员身份**删除任意用户的评论
2. **预期结果**: 成功删除

#### 测试用例 5.4: 普通用户权限限制
1. **使用普通用户账号**
2. **尝试访问**: http://localhost:3000/admin
3. **预期结果**: 显示"访问被拒绝"

### ✅ 6. 搜索功能

#### 测试用例 6.1: 关键词搜索
1. **在导航栏搜索框**输入: "machine learning"
2. **预期结果**: 跳转到搜索结果页面，显示相关论文

#### 测试用例 6.2: 作者搜索
1. **搜索**: "David Silver"
2. **预期结果**: 显示该作者的论文

#### 测试用例 6.3: 空搜索处理
1. **不输入任何内容**点击搜索
2. **预期结果**: 显示搜索提示页面

## 🔧 故障排除

### 常见问题

#### 1. 管理员控制台无法访问
**解决方案**:
```sql
-- 检查用户角色
SELECT email, role FROM public.users WHERE email = 'admin@test.edu.cn';

-- 重新设置管理员角色
UPDATE public.users SET role = 'admin' WHERE email = 'admin@test.edu.cn';
```

#### 2. DOI搜索失败
**可能原因**:
- CrossRef API 限制
- 网络连接问题
- DOI格式错误

**解决方案**:
- 检查网络连接
- 使用测试DOI: `10.1038/nature17946`

#### 3. 评论点赞功能异常
**解决方案**:
```sql
-- 检查评论投票表
SELECT * FROM public.comment_votes LIMIT 5;

-- 检查触发器是否正常
SELECT * FROM public.comments WHERE likes_count > 0 OR dislikes_count > 0;
```

#### 4. 教育邮箱验证失败
**解决方案**:
- 检查 `src/lib/emailValidation.ts` 中的域名列表
- 确认邮箱格式正确

## 📊 测试报告模板

### 功能测试结果

| 功能模块 | 测试用例 | 状态 | 备注 |
|---------|---------|------|------|
| DOI搜索 | 自动获取论文信息 | ✅/❌ | |
| 用户认证 | 教育邮箱验证 | ✅/❌ | |
| 评分系统 | 多维度评分 | ✅/❌ | |
| 评论系统 | 点赞/踩功能 | ✅/❌ | |
| 管理员功能 | 控制台访问 | ✅/❌ | |
| 搜索功能 | 关键词搜索 | ✅/❌ | |

### 性能测试

- **页面加载时间**: < 3秒
- **DOI搜索响应时间**: < 5秒
- **评分提交响应时间**: < 2秒

## 🎯 下一步

测试完成后，您可以：

1. **部署到生产环境** (参考 DEPLOYMENT.md)
2. **邀请真实用户** 进行测试
3. **收集用户反馈** 并改进功能
4. **添加更多论文数据** 丰富内容
5. **优化性能** 和用户体验

---

**测试账号信息**:
- **管理员**: admin@test.edu.cn / Admin123!@#
- **测试DOI**: 10.1038/nature17946
- **管理员控制台**: http://localhost:3000/admin

如有问题，请检查浏览器控制台错误信息和 Supabase 日志。
